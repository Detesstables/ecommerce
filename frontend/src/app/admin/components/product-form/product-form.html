<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="space-y-6">
      
  <h3 class="text-2xl font-bold text-creativa-heading">
    @if (isEditMode) {
      Editar Producto
    } @else {
      Crear Nuevo Producto
    }
  </h3>

  <div>
    <label for="nombre" class="block text-sm font-medium text-creativa-text">Nombre</label>
    <input type="text" id="nombre" formControlName="nombre"
           class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-creativa-primary focus:border-creativa-primary">
    
    <div class="text-red-500 text-sm mt-1 h-5">
      @if (productForm.get('nombre')?.invalid && (productForm.get('nombre')?.dirty || productForm.get('nombre')?.touched)) {
        @if (productForm.get('nombre')?.errors?.['required']) {
          <span>El nombre es requerido.</span>
        }
      }
    </div>
  </div>

  <div>
    <label for="descripcion" class="block text-sm font-medium text-creativa-text">Descripción</label>
    <textarea id="descripcion" formControlName="descripcion" rows="3"
              class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-creativa-primary focus:border-creativa-primary"></textarea>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label for="precio" class="block text-sm font-medium text-creativa-text">Precio (CLP)</label>
      <input type="number" id="precio" formControlName="precio" class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-creativa-primary focus:border-creativa-primary">

      <div class="text-red-500 text-sm mt-1 h-5">
        @if (productForm.get('precio')?.invalid && (productForm.get('precio')?.dirty ||
        productForm.get('precio')?.touched)) {
        <span>El precio es requerido (mín. 1).</span>
        }
      </div>
    </div>

    <div>
      <label for="stock" class="block text-sm font-medium text-creativa-text">Stock</label>
      <input type="number" id="stock" formControlName="stock"
             class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-creativa-primary focus:border-creativa-primary">

      <div class="text-red-500 text-sm mt-1 h-5">
        @if (productForm.get('stock')?.invalid && (productForm.get('stock')?.dirty ||
        productForm.get('stock')?.touched)) {
        <span>El stock es requerido (mín. 0).</span>
        }
      </div>
    </div>
  </div>

  <div>
    <label for="categoria_id" class="block text-sm font-medium text-creativa-text">Categoría</label>
    <select id="categoria_id" formControlName="categoria_id"
      class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-creativa-primary focus:border-creativa-primary">
      <option [ngValue]="null" disabled>Selecciona una categoría...</option>
      @for (cat of categorias; track cat.id) { <option [value]="cat.id">{{ cat.nombre }}</option>
      }
    </select>

    <div class="text-red-500 text-sm mt-1 h-5">
      @if (productForm.get('categoria_id')?.invalid && (productForm.get('categoria_id')?.dirty ||
      productForm.get('categoria_id')?.touched)) {
      <span>Debes seleccionar una categoría.</span>
      }
    </div>
  </div>

  <div>
    <label for="imagen" class="block text-sm font-medium text-creativa-text">Imagen del Producto</label>
    <input type="file" id="imagen" (change)="onFileChange($event)" class="w-full mt-1 text-sm text-creativa-text file:mr-4 file:py-2 file:px-4
             file:rounded-full file:border-0 file:text-sm file:font-semibold
             file:bg-creativa-secondary file:text-creativa-primary
             hover:file:bg-creativa-primary/20">

    @if (isEditMode && data && data.imagenUrl) {
    <p class="text-sm text-gray-500 mt-2">
      Imagen actual:
      <a [href]="'http://localhost:3000' + data.imagenUrl" target="_blank" class="text-creativa-primary underline">
        Ver imagen
      </a>
    </p>
    }
  </div>

  <div class="flex justify-end space-x-4 pt-4">
    <button type="submit" [disabled]="productForm.invalid"
      class="px-4 py-2 text-white bg-creativa-primary rounded-md hover:bg-opacity-90 disabled:opacity-50">
      @if (isEditMode) {
      Guardar Cambios
      } @else {
      Crear Producto
      }
    </button>
  </div>
</form>